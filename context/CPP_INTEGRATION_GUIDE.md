# C++ Builder Integration Guide

–ü–æ–≤–Ω–∏–π –≥–∞–π–¥ –ø–æ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó ML predictor –≤ Difuz.cpp

## üìÅ –§–∞–π–ª–∏ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó

–°—Ç–≤–æ—Ä–µ–Ω–æ **5 –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤** –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ç–≤–æ—ó—Ö –ø–æ—Ç—Ä–µ–±:

### 1. `predict_integration.cpp` - –ü—Ä–æ—Å—Ç–∏–π C-style (–û–†–ò–ì–Ü–ù–ê–õ)
- ‚úÖ –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –∫–æ–¥ –±–µ–∑ VCL
- ‚ö†Ô∏è –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `system()` (–±–ª–æ–∫—É—î UI, –≤—Ä–∞–∑–ª–∏–≤–∏–π)
- ‚ö†Ô∏è –§–∞–π–ª–∏ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è –≤ **–ø–æ—Ç–æ—á–Ω—ñ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó** (–Ω–µ–Ω–∞–¥—ñ–π–Ω–æ!)
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø—É–≤–∞–Ω–Ω—è

### 2. `predict_integration_improved.cpp` - –ü–æ–∫—Ä–∞—â–µ–Ω–∏–π –∑ —à–ª—è—Ö–∞–º–∏
- ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `Application->ExeName` –¥–ª—è –Ω–∞–¥—ñ–π–Ω–∏—Ö —à–ª—è—Ö—ñ–≤
- ‚ö†Ô∏è –í—Å–µ —â–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `system()`
- ‚úÖ –ü—ñ–¥—Ç—Ä–∏–º—É—î —ñ VCL —ñ —á–∏—Å—Ç–∏–π C
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∑–Ω–∞—á–∞—î –ø–æ–≤–Ω—ñ —à–ª—è—Ö–∏ –¥–æ `predict.exe`

### 3. `predict_integration_vcl.cpp` - –ß–∏—Å—Ç–∏–π VCL
- ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `TStringList` –∑–∞–º—ñ—Å—Ç—å `FILE*`
- ‚úÖ VCL `String` API
- ‚ö†Ô∏è –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `system()` (–±–ª–æ–∫—É—î UI)
- ‚úÖ Exception handling –∑ `try/__finally`
- ‚úÖ –ü—Ä–∏–∫–ª–∞–¥ –ø–æ–≤–Ω–æ—ó —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –≤ –∫–Ω–æ–ø–∫—É

### 4. `predict_integration_spawnl.cpp` - –ó _spawnl ‚≠ê –†–ï–ö–û–ú–ï–ù–î–£–Æ
- ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `_spawnl` –∑–∞–º—ñ—Å—Ç—å `system()` - **–ë–ï–ó–ü–ï–ß–ù–Ü–®–ï!**
- ‚úÖ –ê—Ä–≥—É–º–µ–Ω—Ç–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è —è–∫ –º–∞—Å–∏–≤ (–±–µ–∑ –ø—Ä–æ–±–ª–µ–º –∑ –∫–∞–≤–∏—á–∫–∞–º–∏)
- ‚úÖ –ë–µ–∑–ø–µ—á–Ω–æ –¥–ª—è —à–ª—è—Ö—ñ–≤ –∑ –ø—Ä–æ–±—ñ–ª–∞–º–∏
- ‚úÖ VCL + –Ω–∞–¥—ñ–π–Ω—ñ —à–ª—è—Ö–∏
- ‚ö†Ô∏è –í—Å–µ —â–µ –±–ª–æ–∫—É—î UI (–∞–ª–µ —Ü–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è ML inference)
- **–ù–ê–ô–ö–†–ê–©–ò–ô –î–õ–Ø PRODUCTION**

### 5. `predict_integration_timeout.cpp` - –ó timeout üöÄ ADVANCED
- ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `CreateProcessA` - **–ú–ê–ö–°–ò–ú–ê–õ–¨–ù–ò–ô –ö–û–ù–¢–†–û–õ–¨**
- ‚úÖ **TIMEOUT** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–±–∏–≤–∞—î –ø—Ä–æ—Ü–µ—Å —è–∫—â–æ –∑–∞–≤–∏—Å
- ‚úÖ –ü—Ä–∏—Ö–æ–≤—É—î console window (`CREATE_NO_WINDOW`)
- ‚úÖ –ü–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø—Ä–æ—Ü–µ—Å–æ–º
- ‚úÖ –ë–æ–Ω—É—Å: –ø—Ä–∏–∫–ª–∞–¥ TThread –¥–ª—è async –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
- **–í–ò–ö–û–†–ò–°–¢–û–í–£–ô –Ø–ö–©–û –ü–û–¢–†–Ü–ë–ï–ù TIMEOUT –ê–ë–û ASYNC**

## üîç –í—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ —Ç–≤–æ—ó –ø–∏—Ç–∞–Ω–Ω—è

### 1. –î–µ —Å—Ç–≤–æ—Ä—è—Ç—å—Å—è `temp_curve.txt` —Ç–∞ `temp_params.txt`?

**–í –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—ñ–π –≤–µ—Ä—Å—ñ—ó:**
```cpp
const char* temp_curve = "temp_curve.txt";  // –í—ñ–¥–Ω–æ—Å–Ω–∏–π —à–ª—è—Ö!
```

–§–∞–π–ª–∏ —Å—Ç–≤–æ—Ä—è—Ç—å—Å—è –≤ **current working directory**, —è–∫–∞ –º–æ–∂–µ –±—É—Ç–∏:
- `C:\Program Files\Difuz\` (—è–∫—â–æ –∑–∞–ø—É—â–µ–Ω–æ –∑–≤—ñ–¥—Ç–∏)
- `C:\Windows\System32` (—è–∫—â–æ –∑–∞–ø—É—â–µ–Ω–æ —á–µ—Ä–µ–∑ Explorer –ø–æ–¥–≤—ñ–π–Ω–∏–º –∫–ª—ñ–∫–æ–º)
- –ë—É–¥—å-—è–∫–∞ —ñ–Ω—à–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è

‚ùå **–ü—Ä–æ–±–ª–µ–º–∏:**
- –ú–æ–∂–µ –Ω–µ –±—É—Ç–∏ –ø—Ä–∞–≤ –Ω–∞ –∑–∞–ø–∏—Å (Program Files, System32)
- –ù–µ –∑–Ω–∞—î—à –¥–µ —à—É–∫–∞—Ç–∏ —Ñ–∞–π–ª–∏ —è–∫—â–æ —â–æ—Å—å –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫
- –ö–æ–Ω—Ñ–ª—ñ–∫—Ç–∏ —è–∫—â–æ –∫—ñ–ª—å–∫–∞ –µ–∫–∑–µ–º–ø–ª—è—Ä—ñ–≤ –ø—Ä–æ–≥—Ä–∞–º–∏

‚úÖ **–†—ñ—à–µ–Ω–Ω—è (–≤ improved/vcl –≤–µ—Ä—Å—ñ—è—Ö):**
```cpp
String appDir = ExtractFilePath(Application->ExeName);
String tempCurve = appDir + "temp_curve.txt";
// –¢–µ–ø–µ—Ä —Ñ–∞–π–ª —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –ø–æ—Ä—É—á –∑ Difuz.exe
```

### 2. –ß–∏ —Å–ø—Ä–∞—Ü—é—î `system(cmd)`?

**–¢–∞–∫, –∞–ª–µ –∑ –Ω—é–∞–Ω—Å–∞–º–∏:**

‚úÖ **–ü—Ä–∞—Ü—é—î:**
```cpp
system("\"predict.exe\" \"temp_curve.txt\" \"temp_params.txt\"");
```

‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∏:**

1. **–ë–õ–û–ö–£–Ñ UI –Ω–∞ 1-2 —Å–µ–∫—É–Ω–¥–∏** - –≤—ñ–∫–Ω–æ –∑–∞–≤–∏—Å–Ω–µ –ø—ñ–¥ —á–∞—Å –ø—Ä–µ–¥–∏–∫—Ü—ñ—ó
   ```cpp
   // UI –∑–∞–º–æ—Ä–æ–∂—É—î—Ç—å—Å—è —Ç—É—Ç:
   int result = system(cmd);
   // ... —á–µ–∫–∞—î 1-2 —Å–µ–∫ ...
   // UI –≤—ñ–¥–º–æ—Ä–æ–∂—É—î—Ç—å—Å—è —Ç—É—Ç
   ```

2. **–ú–æ–∂–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ Windows security warning** –≤ –¥–µ—è–∫–∏—Ö –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è—Ö

3. **–¢—Ä–µ–±–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –µ–∫—Ä–∞–Ω—É–≤–∞—Ç–∏ —à–ª—è—Ö–∏ –∑ –ø—Ä–æ–±—ñ–ª–∞–º–∏:**
   ```cpp
   // –ü—Ä–∞–≤–∏–ª—å–Ω–æ:
   sprintf(cmd, "\"%s\" \"%s\" \"%s\"", predictor_path, temp_curve, temp_params);

   // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (—è–∫—â–æ —à–ª—è—Ö–∏ –∑ –ø—Ä–æ–±—ñ–ª–∞–º–∏):
   sprintf(cmd, "%s %s %s", predictor_path, temp_curve, temp_params);
   ```

4. **`predict.exe` –º–∞—î –±—É—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω–∏–π:**
   - –í PATH
   - –ê–±–æ –≤ –ø–æ—Ç–æ—á–Ω—ñ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó
   - –ê–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –ø–æ–≤–Ω–∏–π —à–ª—è—Ö

‚úÖ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó:**

**–í–∞—Ä—ñ–∞–Ω—Ç –ê - –î–æ–¥–∞—Ç–∏ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:**
```cpp
void __fastcall TForm1::PredictButtonClick(TObject *Sender)
{
    // –ü–æ–∫–∞–∑–∞—Ç–∏ —â–æ –ø—Ä–∞—Ü—é—î
    Cursor = crHourGlass;
    StatusBar->SimpleText = "Predicting parameters...";
    Application->ProcessMessages();  // –û–Ω–æ–≤–∏—Ç–∏ UI

    // –í–∏–∫–ª–∏–∫–∞—Ç–∏ predictor (–±–ª–æ–∫—É—î –Ω–∞ 1-2 —Å–µ–∫)
    DeformParams params;
    int success = PredictFromCurve(curve, 661, &params, "predict.exe");

    // –ü–æ–≤–µ—Ä–Ω—É—Ç–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–∏–π cursor
    Cursor = crDefault;
    StatusBar->SimpleText = success ? "Done!" : "Failed!";
}
```

**–í–∞—Ä—ñ–∞–Ω—Ç –ë - –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –≤ –æ–∫—Ä–µ–º–æ–º—É –ø–æ—Ç–æ—Ü—ñ (—Å–∫–ª–∞–¥–Ω—ñ—à–µ):**
```cpp
// –°—Ç–≤–æ—Ä–∏—Ç–∏ TThread –¥–ª—è non-blocking –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
class TPredictThread : public TThread {
    // ... —Å–∫–ª–∞–¥–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è ...
};
```

**–í–∞—Ä—ñ–∞–Ω—Ç –í - –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ CreateProcess() –∑–∞–º—ñ—Å—Ç—å system():**
```cpp
// –ë—ñ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—é, –∞–ª–µ –±—ñ–ª—å—à–µ –∫–æ–¥—É
STARTUPINFO si = {sizeof(si)};
PROCESS_INFORMATION pi;
CreateProcess(NULL, cmd, NULL, NULL, FALSE, 0, NULL, NULL, &si, &pi);
WaitForSingleObject(pi.hProcess, INFINITE);
```

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç (_spawnl –≤–µ—Ä—Å—ñ—è - –†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–û)

### –ö—Ä–æ–∫ 1: –î–æ–¥–∞—Ç–∏ —Ñ–∞–π–ª–∏ –¥–æ –ø—Ä–æ–µ–∫—Ç—É

```
Difuz/
‚îú‚îÄ‚îÄ predict_integration.h
‚îú‚îÄ‚îÄ predict_integration_spawnl.cpp  ‚Üê –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —Ü–µ–π! ‚≠ê
‚îî‚îÄ‚îÄ predict.exe                     ‚Üê Windows build (200-250 MB)
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–µ–Ω timeout):**
```
Difuz/
‚îú‚îÄ‚îÄ predict_integration.h
‚îú‚îÄ‚îÄ predict_integration_timeout.cpp  ‚Üê –ó timeout –∑–∞—Ö–∏—Å—Ç–æ–º üöÄ
‚îî‚îÄ‚îÄ predict.exe
```

### –ö—Ä–æ–∫ 2: –î–æ–¥–∞—Ç–∏ #include

```cpp
// –í Difuz.cpp
#include "predict_integration.h"
```

### –ö—Ä–æ–∫ 3: –í–∏–∫–ª–∏–∫–∞—Ç–∏ –≤ –æ–±—Ä–æ–±–Ω–∏–∫—É –∫–Ω–æ–ø–∫–∏

```cpp
void __fastcall TForm1::Button1Click(TObject *Sender)
{
    // –ü—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ –∫—Ä–∏–≤–æ—ó (661 —Ç–æ—á–∫–∞)
    double curve[661];
    for (int i = 0; i < 661; i++) {
        curve[i] = R_vseZ[i + 40];  // –¢–≤—ñ–π –º–∞—Å–∏–≤ –¥–∞–Ω–∏—Ö
    }

    // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø—Ä–æ–≥—Ä–µ—Å
    Cursor = crHourGlass;
    StatusBar->SimpleText = "ML prediction in progress...";
    Application->ProcessMessages();

    // PREDICT!
    DeformParams predicted;
    int success = PredictFromCurve(curve, 661, &predicted, "predict.exe");

    // –ü–æ–≤–µ—Ä–Ω—É—Ç–∏ UI
    Cursor = crDefault;

    if (success) {
        // –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –¥–æ Edit –ø–æ–ª—ñ–≤
        Edit_Dmax1->Text = FloatToStrF(predicted.Dmax1, ffFixed, 8, 6);
        Edit_D01->Text = FloatToStrF(predicted.D01, ffFixed, 8, 6);
        Edit_L1->Text = FloatToStrF(predicted.L1, ffExponent, 8, 2);
        Edit_Rp1->Text = FloatToStrF(predicted.Rp1, ffExponent, 8, 2);
        Edit_D02->Text = FloatToStrF(predicted.D02, ffFixed, 8, 6);
        Edit_L2->Text = FloatToStrF(predicted.L2, ffExponent, 8, 2);
        Edit_Rp2->Text = FloatToStrF(predicted.Rp2, ffExponent, 8, 2);

        StatusBar->SimpleText = "Prediction successful!";
    } else {
        ShowMessage("Prediction failed!\n\nCheck:\n"
                   "1. predict.exe exists\n"
                   "2. Curve has 661 points\n"
                   "3. Write permissions");
        StatusBar->SimpleText = "Error";
    }
}
```

## ‚öôÔ∏è –ó–±—ñ—Ä–∫–∞ predict.exe –¥–ª—è Windows

**–ù–∞ Windows –º–∞—à–∏–Ω—ñ:**

```bash
# –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
pip install pyinstaller torch numpy scipy matplotlib tqdm

# –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ —Ñ–∞–π–ª–∏ –∑ macOS:
# - build_predictor.py
# - predict.py
# - model_common.py
# - checkpoints/dataset_1000_dl100_7d_curve_val_best_curve.pt

# –ó—ñ–±—Ä–∞—Ç–∏ .exe
python build_predictor.py
```

–û—Ç—Ä–∏–º–∞—î—à: `dist/predict.exe` (~200-250 MB)

## üîß Troubleshooting

### –ü–æ–º–∏–ª–∫–∞: "Prediction failed"

**–ü–µ—Ä–µ–≤—ñ—Ä:**
1. `predict.exe` —ñ—Å–Ω—É—î –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó Difuz.exe
2. Curve –º–∞—î —Ä—ñ–≤–Ω–æ 661 —Ç–æ—á–∫—É
3. –Ñ –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å —Ñ–∞–π–ª—ñ–≤ (–Ω–µ Program Files)

**Debug:**
```cpp
// –î–æ–¥–∞—Ç–∏ –¥–µ—Ç–∞–ª—å–Ω—É –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É:
String appDir = ExtractFilePath(Application->ExeName);
String predictorPath = appDir + "predict.exe";

if (!FileExists(predictorPath)) {
    ShowMessage("predict.exe not found at:\n" + predictorPath);
    return;
}

ShowMessage("Predictor path: " + predictorPath);
```

### UI –≤–∏—Å–∏—Ç—å –ø—ñ–¥ —á–∞—Å –ø—Ä–µ–¥–∏–∫—Ü—ñ—ó

**–¶–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ** - `system()` –±–ª–æ–∫—É—î UI –Ω–∞ 1-2 —Å–µ–∫—É–Ω–¥–∏.

**–†—ñ—à–µ–Ω–Ω—è:**
- –î–æ–¥–∞—Ç–∏ `Cursor = crHourGlass` (–ø–æ–∫–∞–∑—É—î —â–æ –ø—Ä–æ–≥—Ä–∞–º–∞ –ø—Ä–∞—Ü—é—î)
- –ê–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ –æ–∫—Ä–µ–º–∏–π –ø–æ—Ç—ñ–∫ (—Å–∫–ª–∞–¥–Ω—ñ—à–µ)

### –§–∞–π–ª–∏ temp_*.txt –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –ø—ñ—Å–ª—è –ø–æ–º–∏–ª–∫–∏

**–í VCL –≤–µ—Ä—Å—ñ—ó —Ü–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ:**
```cpp
try {
    // ... —Ä–æ–±–æ—Ç–∞ –∑ —Ñ–∞–π–ª–∞–º–∏ ...
}
catch (...) {
    DeleteFile(tempCurve);   // Cleanup –Ω–∞–≤—ñ—Ç—å –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ
    DeleteFile(tempParams);
    return 0;
}
```

## üìä –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª—ñ–≤

### temp_curve.txt (INPUT)
```
1.234567e+02
2.345678e+02
3.456789e+02
...
(661 lines total)
```

### temp_params.txt (OUTPUT)
```
Dmax1    0.015234
D01      0.012456
L1       3.456789e+03
Rp1      2.123456e+03
D02      0.018901
L2       2.789012e+03
Rp2      -1.234567e+03
```

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

1. **–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π VCL –≤–µ—Ä—Å—ñ—é** (`predict_integration_vcl.cpp`) - –Ω–∞–π–∑—Ä—É—á–Ω—ñ—à–∞ –¥–ª—è Difuz.cpp
2. **–î–æ–¥–∞–π —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è** - UI –≤–∏—Å–∏—Ç—å 1-2 —Å–µ–∫—É–Ω–¥–∏
3. **–ü–æ–º—ñ—Å—Ç–∏ predict.exe** –ø–æ—Ä—É—á –∑ Difuz.exe
4. **–¢–µ—Å—Ç—É–π –Ω–∞ Windows** - –∑—ñ–±—Ä–∞–Ω–∏–π macOS `predict` –Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ –Ω–∞ Windows!

## üéØ –Ø–∫—É –≤–µ—Ä—Å—ñ—é –≤–∏–±—Ä–∞—Ç–∏?

### –ü–æ—Ä—ñ–≤–Ω—è–ª—å–Ω–∞ —Ç–∞–±–ª–∏—Ü—è

| –ö—Ä–∏—Ç–µ—Ä—ñ–π | –ü—Ä–æ—Å—Ç–∞ | Improved | VCL | _spawnl ‚≠ê | Timeout üöÄ |
|----------|--------|----------|-----|----------|----------|
| **–ú–µ—Ç–æ–¥ –≤–∏–∫–ª–∏–∫—É** | system() | system() | system() | _spawnl | CreateProcess |
| **–ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å —à–ª—è—Ö—ñ–≤** | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| **–ë–µ–∑–ø–µ–∫–∞ –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤** | ‚ö†Ô∏è | ‚ö†Ô∏è | ‚ö†Ô∏è | ‚úÖ‚úÖ | ‚úÖ‚úÖ |
| **–®–ª—è—Ö–∏ –∑ –ø—Ä–æ–±—ñ–ª–∞–º–∏** | ‚ö†Ô∏è | ‚ö†Ô∏è | ‚ö†Ô∏è | ‚úÖ | ‚úÖ |
| **Timeout –∑–∞—Ö–∏—Å—Ç** | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚úÖ‚úÖ |
| **VCL —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è** | ‚ùå | ‚ö†Ô∏è | ‚úÖ | ‚úÖ | ‚úÖ |
| **Error handling** | ‚ö†Ô∏è | ‚úÖ | ‚úÖ‚úÖ | ‚úÖ‚úÖ | ‚úÖ‚úÖ |
| **–ü—Ä–∏—Ö–æ–≤—É—î console** | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚úÖ |
| **Async –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å** | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚úÖ (TThread) |
| **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –∫–æ–¥—É** | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê | ‚≠ê‚≠ê | ‚≠ê‚≠ê | ‚≠ê |
| **–†–ï–ö–û–ú–ï–ù–î–ê–¶–Ü–Ø** | ‚ùå | ‚ö†Ô∏è | ‚ö†Ô∏è | ‚úÖ‚úÖ‚úÖ | ‚úÖ‚úÖ |

### üèÜ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

**–î–ª—è —à–≤–∏–¥–∫–æ–≥–æ —Å—Ç–∞—Ä—Ç—É:**
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π `predict_integration_spawnl.cpp` ‚≠ê

**–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–µ–Ω timeout –∞–±–æ async:**
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π `predict_integration_timeout.cpp` üöÄ

**–£–ù–ò–ö–ê–ô:**
- ‚ùå `predict_integration.cpp` - –Ω–µ–Ω–∞–¥—ñ–π–Ω—ñ —à–ª—è—Ö–∏
- ‚ùå `predict_integration_improved.cpp` - –≤—Å–µ —â–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î system()
- ‚ùå `predict_integration_vcl.cpp` - –≤—Å–µ —â–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î system()

### üìä –î–µ—Ç–∞–ª—å–Ω–µ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –º–µ—Ç–æ–¥—ñ–≤ –≤–∏–∫–ª–∏–∫—É

#### system() - ‚ùå –ù–ï –†–ï–ö–û–ú–ï–ù–î–£–Ñ–¢–¨–°–Ø

```cpp
// –ü–†–û–ë–õ–ï–ú–ò:
system("\"predict.exe\" \"temp_curve.txt\" \"temp_params.txt\"");

// 1. –í—Ä–∞–∑–ª–∏–≤–∏–π –¥–æ command injection
// 2. –ü—Ä–æ–±–ª–µ–º–∏ –∑ —à–ª—è—Ö–∞–º–∏ –∑ –ø—Ä–æ–±—ñ–ª–∞–º–∏
// 3. –í–∞–∂–∫–æ –¥–µ–±–∞–∂–∏—Ç–∏
// 4. –ù–µ–º–∞—î –∫–æ–Ω—Ç—Ä–æ–ª—é –Ω–∞–¥ –ø—Ä–æ—Ü–µ—Å–æ–º
```

#### _spawnl() - ‚úÖ –î–û–ë–†–ï –î–õ–Ø –ë–Ü–õ–¨–®–û–°–¢–Ü –í–ò–ü–ê–î–ö–Ü–í

```cpp
// –ü–ï–†–ï–í–ê–ì–ò:
_spawnl(_P_WAIT, exe, exe, arg1, arg2, NULL);

// ‚úÖ –ê—Ä–≥—É–º–µ–Ω—Ç–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è —è–∫ –º–∞—Å–∏–≤ (–±–µ–∑–ø–µ—á–Ω–æ!)
// ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –µ–∫—Ä–∞–Ω—É–≤–∞–Ω–Ω—è
// ‚úÖ –ù–µ–º–∞—î –ø—Ä–æ–±–ª–µ–º –∑ –ø—Ä–æ–±—ñ–ª–∞–º–∏
// ‚úÖ –ü—Ä–æ—Å—Ç–∏–π API
// ‚ö†Ô∏è –í—Å–µ —â–µ –±–ª–æ–∫—É—î UI (–∞–ª–µ —Ü–µ OK –¥–ª—è ML)
```

#### CreateProcess() - üöÄ –ù–ê–ô–ö–†–ê–©–ò–ô –î–õ–Ø PRODUCTION

```cpp
// –ü–ï–†–ï–í–ê–ì–ò:
CreateProcessA(...);
WaitForSingleObject(hProcess, timeout);

// ‚úÖ‚úÖ –ü–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å
// ‚úÖ‚úÖ Timeout –∑–∞—Ö–∏—Å—Ç
// ‚úÖ‚úÖ –ú–æ–∂–Ω–∞ –ø—Ä–∏—Ö–æ–≤–∞—Ç–∏ console
// ‚úÖ‚úÖ –ú–æ–∂–Ω–∞ —á–∏—Ç–∞—Ç–∏ stdout/stderr
// ‚úÖ‚úÖ Async —á–µ—Ä–µ–∑ TThread
// ‚ö†Ô∏è –°–∫–ª–∞–¥–Ω—ñ—à–∏–π –∫–æ–¥
```

**–î–ª—è Difuz.cpp —Ä–µ–∫–æ–º–µ–Ω–¥—É—é _spawnl –≤–µ—Ä—Å—ñ—é!**
