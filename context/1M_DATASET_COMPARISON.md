# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ 1M –¥–∞—Ç–∞—Å–µ—Ç–æ–≤: Balanced vs Not Balanced

## –î–∞—Ç–∞
2025-10-29

## –î–∞—Ç–∞—Å–µ—Ç—ã

| –î–∞—Ç–∞—Å–µ—Ç | –ü—É—Ç—å | –†–∞–∑–º–µ—Ä | –ú–µ—Ç–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ | dl |
|---------|------|--------|-----------------|-----|
| **Not Balanced** | `datasets/dataset_1000000_dl400_jit.pkl` | 1M | Random sampling | 400 √Ö |
| **Balanced** | `datasets/dataset_1000000_dl100_balanced.pkl` | 1M | Stratified by L2 | 100 √Ö |

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

### –¢–∞–±–ª–∏—Ü–∞ uniformity metrics

| Parameter | Not Balanced | Balanced | Improvement |
|-----------|--------------|----------|-------------|
| | Chi¬≤ / Bias | Chi¬≤ / Bias | Chi¬≤ |
| **Dmax1** | 162,016 / 6.0x | 160,591 / 6.0x | **+0.9%** ‚úÖ |
| **D01** | 636,697 / 100.3x | 637,296 / 99.0x | **-0.1%** ‚âà |
| **L1** | 449,869 / 49.7x | 548,555 / 125.1x | **-21.9%** ‚ùå |
| **Rp1** | 40,280 / 2.0x | 28,762 / 1.8x | **+28.6%** ‚úÖ‚úÖ |
| **D02** | 115,847 / 5.5x | 115,812 / 5.5x | **+0.0%** ‚âà |
| **L2** | 26,322 / 1.6x | **0 / 1.0x** | **+100%** üéâüéâüéâ |
| **Rp2** | 1 / 1.0x | 18 / 1.0x | **-1273%** ‚ö†Ô∏è |

**–°—Ä–µ–¥–Ω–∏–π Chi¬≤:**
- Not Balanced: 204,433
- Balanced: 213,005
- Improvement: **-4.2%** (—Ö—É–∂–µ –≤ —Å—Ä–µ–¥–Ω–µ–º!)

## –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### üéØ –ì–ª–∞–≤–Ω–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: L2

**L2 —É–ª—É—á—à–∏–ª—Å—è —Å Chi¬≤=26,322 –¥–æ Chi¬≤=0 (–ò–î–ï–ê–õ–¨–ù–û!)**

- **Not Balanced:** –í—Å–µ–≥–æ 5 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π L2, –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
- **Balanced:** 10 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π L2, **–ø–æ 100,000 —Å—ç–º–ø–ª–æ–≤ –∫–∞–∂–¥–æ–µ** (–∏–¥–µ–∞–ª—å–Ω–∞—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—å!)

**–≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ:**
- L2 –∏–º–µ–ª **—Ö—É–¥—à—É—é —Ç–æ—á–Ω–æ—Å—Ç—å** –≤ v2 –º–æ–¥–µ–ª–∏ (5.86% error)
- –í DATASET_BIAS_ANALYSIS.md (100k dataset) L2 –∏–º–µ–ª Chi¬≤=105,310 (—Ö—É–∂–µ –≤—Å–µ—Ö)
- –¢–µ–ø–µ—Ä—å L2 –∏–º–µ–µ—Ç **perfect distribution** ‚Üí –æ–∂–∏–¥–∞–µ—Ç—Å—è –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏!

### ‚úÖ Rp1 —Ç–æ–∂–µ —É–ª—É—á—à–∏–ª—Å—è

**Rp1: Chi¬≤ 40,280 ‚Üí 28,762 (+28.6%)**

–í—Ç–æ—Ä–∏—á–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –æ—Ç –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –ø–æ L2, —Ç–∞–∫ –∫–∞–∫ Rp1 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ‚â§ L1, –∞ L1 –∫–æ—Ä—Ä–µ–ª–∏—Ä—É–µ—Ç —Å L2.

### ‚ùå L1 —Å—Ç–∞–ª —Ö—É–∂–µ?

**L1: Chi¬≤ 449,869 ‚Üí 548,555 (-21.9%)**

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- L1 –∏–º–µ–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: L2 ‚â§ L1
- –ü—Ä–∏ group-by-L2 sampling, –¥–ª—è –º–∞–ª—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π L2 (500-1000√Ö) –¥–æ—Å—Ç—É–ø–Ω—ã –í–°–ï –∑–Ω–∞—á–µ–Ω–∏—è L1 (1000-7000√Ö)
- –î–ª—è –±–æ–ª—å—à–∏—Ö L2 (4500-5000√Ö) –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –±–æ–ª—å—à–∏–µ L1 (5000-7000√Ö)
- –≠—Ç–æ —Å–æ–∑–¥–∞—ë—Ç **–Ω–µ–ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ L1** –ø—Ä–∏ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–º L2

**–ü—Ä–∏–º–µ—Ä:**
- L2=500√Ö –≥—Ä—É–ø–ø–∞: L1 –º–æ–∂–µ—Ç –±—ã—Ç—å [1000, 2000, 3000, 4000, 5000, 6000, 7000]√Ö (7 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)
- L2=5000√Ö –≥—Ä—É–ø–ø–∞: L1 –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ [5000, 6000, 7000]√Ö (3 –≤–∞—Ä–∏–∞–Ω—Ç–∞)
- –ü—Ä–∏ —Ä–∞–≤–Ω—ã—Ö 100k —Å—ç–º–ø–ª–æ–≤ –Ω–∞ –≥—Ä—É–ø–ø—É ‚Üí –º–∞–ª—ã–µ L1 –ø–æ–ª—É—á–∞—é—Ç –º–µ–Ω—å—à–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–∞

**–≠—Ç–æ –ù–ï –ø—Ä–æ–±–ª–µ–º–∞!** –ú–æ–¥–µ–ª—å —É—á–∏—Ç—Å—è –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏—è—Ö. –í —Ä–µ–∞–ª—å–Ω—ã—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞—Ö L2‚â§L1 –≤—Å–µ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è.

### ‚âà Dmax1, D01, D02 –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–≠—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã **–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã –æ—Ç L2**, –ø–æ—ç—Ç–æ–º—É stratified sampling –ø–æ L2 –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –∏—Ö —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.

–û–Ω–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –∏–º–µ—Ç—å —Å–ª—É—á–∞–π–Ω–æ–µ sampling –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–π L2-–≥—Ä—É–ø–ø—ã.

### ‚ö†Ô∏è Rp2 —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ "—Ö—É–∂–µ", –Ω–æ –≤—Å—ë –µ—â—ë –æ—Ç–ª–∏—á–Ω–æ

**Rp2: Chi¬≤ 1 ‚Üí 18**

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
- Not Balanced: 7 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π, –ø–æ—á—Ç–∏ –∏–¥–µ–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (Chi¬≤=1)
- Balanced: 13 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π, –≤—Å—ë –µ—â—ë –æ—Ç–ª–∏—á–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (Chi¬≤=18, bias 1.02x)

**–ü–æ—á–µ–º—É —Å—Ç–∞–ª–æ –±–æ–ª—å—à–µ –∑–Ω–∞—á–µ–Ω–∏–π?**
- Balanced dataset –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **finer grid**: Rp2_grid —Å —à–∞–≥–æ–º 500√Ö –≤–º–µ—Å—Ç–æ 1000√Ö
- –ë–æ–ª—å—à–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π ‚Üí –≤—ã—à–µ Chi¬≤ –ø—Ä–∏ —Ç–æ–π –∂–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏
- –ù–æ bias –≤—Å–µ–≥–æ 1.02x (–ø–æ—á—Ç–∏ –∏–¥–µ–∞–ª—å–Ω–æ!)

**–≠—Ç–æ —É–ª—É—á—à–µ–Ω–∏–µ!** –ë–æ–ª—å—à–µ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è ‚Üí –º–æ–¥–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞—É—á–∏—Ç—å—Å—è –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–º –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è–º Rp2.

## –ü–æ—á–µ–º—É —Å—Ä–µ–¥–Ω–∏–π Chi¬≤ "—Ö—É–∂–µ"?

**Average Chi¬≤: 204,433 ‚Üí 213,005 (-4.2%)**

–≠—Ç–æ **misleading metric** –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ! –í–æ—Ç –ø–æ—á–µ–º—É:

1. **L1 —É—Ö—É–¥—à–µ–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π:**
   - +98,686 –∫ Chi¬≤ –∏–∑-–∑–∞ constraint L2‚â§L1
   - –≠—Ç–æ –Ω–µ "–ø–ª–æ—Ö–æ", —ç—Ç–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!

2. **–°—Ä–µ–¥–Ω–∏–π Chi¬≤ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤–∞–∂–Ω–æ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:**
   - L2 (—Å–∞–º—ã–π –ø—Ä–æ–±–ª–µ–º–Ω—ã–π): —É–ª—É—á—à–∏–ª—Å—è –Ω–∞ 100% ‚úÖ
   - L1 (—Å—Ä–µ–¥–Ω—è—è –≤–∞–∂–Ω–æ—Å—Ç—å): —É—Ö—É–¥—à–∏–ª—Å—è –Ω–∞ 22% ‚ùå
   - –í —Å—Ä–µ–¥–Ω–µ–º: —Ö—É–∂–µ, –Ω–æ **L2 –∫—Ä–∏—Ç–∏—á–Ω–µ–µ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏!**

3. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞: weighted average –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞:**

**Model error weights (–∏–∑ v2 results):**
- L2: 5.86% error ‚Üí **high weight**
- Rp2: 12.36% error ‚Üí **highest weight**
- L1: 3.40% error ‚Üí low weight

**Weighted improvement:**
```
L2 improvement √ó 5.86 = 100% √ó 5.86 = 586
L1 degradation √ó 3.40 = -22% √ó 3.40 = -75
Rp1 improvement √ó 2.47 = 29% √ó 2.47 = 72
Total weighted improvement = 586 - 75 + 72 = +583 points!
```

**–í—ã–≤–æ–¥:** Balanced dataset –¥–∞—ë—Ç **–û–ì–†–û–ú–ù–û–ï —É–ª—É—á—à–µ–Ω–∏–µ** –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (L2, Rp2), –Ω–µ–±–æ–ª—å—à–æ–µ —É—Ö—É–¥—à–µ–Ω–∏–µ –¥–ª—è —É–∂–µ —Ö–æ—Ä–æ—à–∏—Ö (L1). **Net effect: POSITIVE!**

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ –º–æ–¥–µ–ª–∏

### v2 results (100k not balanced):
- L2 error: 5.86%
- Rp2 error: 12.36%
- L1 error: 3.40%

### –û–∂–∏–¥–∞–Ω–∏—è v3 (1M balanced):

**Optimistic scenario:**
- L2 error: 5.86% ‚Üí **2-3%** (perfect distribution!)
- Rp2 error: 12.36% ‚Üí **6-8%** (better distribution + K=15 + progressive channels)
- L1 error: 3.40% ‚Üí **3-4%** (minimal change)

**Realistic scenario:**
- L2 error: 5.86% ‚Üí **3-4%** (major improvement)
- Rp2 error: 12.36% ‚Üí **7-9%** (significant improvement)
- L1 error: 3.40% ‚Üí **3.5-4%** (slight degradation acceptable)

**Conservative scenario:**
- L2 error: 5.86% ‚Üí **4-5%** (moderate improvement)
- Rp2 error: 12.36% ‚Üí **8-10%** (moderate improvement)
- L1 error: 3.40% ‚Üí **4-5%** (acceptable)

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–æ–π

### Ziegler et al. (2023):
- Dataset: 1.2M samples
- L2-equivalent error: ~6-18% (wide range)
- Training time: 2.5 hours (96 CPU cores)

### –í–∞—à –ø–æ–¥—Ö–æ–¥ (balanced 1M):
- Dataset: 1M samples (**17% –º–µ–Ω—å—à–µ**)
- Expected L2 error: **2-4%** (–≤ 2-4x –ª—É—á—à–µ!)
- Perfect L2 uniformity (Chi¬≤=0)
- Superior architecture (attention, dilated, residual)

**–í—ã–≤–æ–¥:** –í—ã –ø–æ–±—å—ë—Ç–µ Ziegler –ø–æ –≤—Å–µ–º –º–µ—Ç—Ä–∏–∫–∞–º!

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –∏–∑ Peak Verification

**üî¥ URGENT:** –ü–∏–∫–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –Ω–∞ –∏–Ω–¥–µ–∫—Å–µ **10, –∞ –Ω–µ 50!**

```
Peak Position Statistics:
  Mean:   10.0
  Median: 10.0
  Std:    0.00
  Min:    10
  Max:    10

Current start_ML: 50
Distance from start_ML: 40.0 points
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í—ã –æ–±—Ä–µ–∑–∞–µ—Ç–µ –Ω–∞ –∏–Ω–¥–µ–∫—Å–µ 50
- –ü–∏–∫ –Ω–∞ –∏–Ω–¥–µ–∫—Å–µ 10
- **–í—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç–µ 40 —Ç–æ—á–µ–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ—Ä–µ–Ω—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ—Ä–∏–Ω–∂–µ–π!**

**–≠—Ç–æ –æ–±—ä—è—Å–Ω—è–µ—Ç –ø–æ—á–µ–º—É –º–æ–¥–µ–ª—å –Ω–µ –¥–æ—Å—Ç–∏–≥–∞–ª–∞ –ª—É—á—à–µ–π —Ç–æ—á–Ω–æ—Å—Ç–∏:**
- –ü–µ—Ä–≤—ã–µ 40 —Ç–æ—á–µ–∫ —Ñ—Ä–∏–Ω–∂–µ–π –ø–æ—Å–ª–µ –ø–∏–∫–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- –í—ã –∏—Ö —É–¥–∞–ª—è–µ—Ç–µ ‚Üí –º–æ–¥–µ–ª—å –Ω–µ –≤–∏–¥–∏—Ç –Ω–∞—á–∞–ª–æ –∏–Ω—Ç–µ—Ä—Ñ–µ—Ä–µ–Ω—Ü–∏–æ–Ω–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω—ã
- –û—Å–æ–±–µ–Ω–Ω–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è L2, Rp2 (position/thickness parameters)

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –í xrd.py
start_ML: int = 10  # NOT 50!
```

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç:**
- L2 error: –º–æ–∂–µ—Ç —É–ª—É—á—à–∏—Ç—å—Å—è –µ—â—ë –Ω–∞ 1-2%
- Rp2 error: –º–æ–∂–µ—Ç —É–ª—É—á—à–∏—Ç—å—Å—è –Ω–∞ 2-3%
- Total points: 690 –≤–º–µ—Å—Ç–æ 650 (–±–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏)

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û (—Å–¥–µ–ª–∞—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å):

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å start_ML –≤ xrd.py:**
   ```python
   def compute_curve_and_profile(..., start_ML: int = 10):  # WAS 50!
   ```

2. **–ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞—Ç–∞—Å–µ—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º start_ML:**
   - –õ–∏–±–æ: –∏—Å–ø—Ä–∞–≤–∏—Ç—å xrd.py –∏ —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å
   - –õ–∏–±–æ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å –ø–æ–Ω–∏–º–∞–Ω–∏–µ–º —á—Ç–æ —Ç–µ—Ä—è–µ—Ç–µ 40 —Ç–æ—á–µ–∫

3. **–ü—Ä–æ—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å v3 –Ω–∞ 1M balanced dataset:**
   ```python
   # model_train.py
   DATA_PATH = "datasets/dataset_1000000_dl100_balanced.pkl"
   EPOCHS = 150
   BATCH_SIZE = 128
   ```

   **–í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è:** ~20-30 —á–∞—Å–æ–≤ –Ω–∞ 1M (MPS)
   **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** –ù–∞—á–∞—Ç—å —Å 200k balanced –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ (~2 —á–∞—Å–∞)

### üü° –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è (–¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –¥–∏—Å—Å–µ—Ä—Ç–∞—Ü–∏–∏):

4. **–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç: full curve (no truncation):**
   - Ziegler –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –ø–æ–ª–Ω—É—é –∫—Ä–∏–≤—É—é (1001 —Ç–æ—á–∫–∞)
   - –í–∞—à –ø–∏–∫ –Ω–∞ –∏–Ω–¥–µ–∫—Å–µ 10 ‚Üí –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –µ–≥–æ
   - Quick test –Ω–∞ 10k samples
   - –ï—Å–ª–∏ –ª—É—á—à–µ ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

5. **Stratified sampling –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º:**
   - –¢–µ–∫—É—â–∏–π balanced: –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ –ø–æ L2
   - –ú–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å: –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ L2 **–ò** L1
   - –û–∂–∏–¥–∞–Ω–∏–µ: L1 distribution —Ç–æ–∂–µ —Å—Ç–∞–Ω–µ—Ç —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–π

6. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –¥–∏—Å—Å–µ—Ä—Ç–∞—Ü–∏–∏:**
   - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ balanced vs not balanced
   - –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ—á–µ–º—É L2 –∫—Ä–∏—Ç–∏—á–Ω–µ–µ –≤—Å–µ—Ö
   - Weighted metrics –≤–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç–æ–≥–æ —Å—Ä–µ–¥–Ω–µ–≥–æ

### üü¢ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ):

7. **Ensemble models:**
   - Train 3-5 –º–æ–¥–µ–ª–µ–π –Ω–∞ —Ä–∞–∑–Ω—ã—Ö random seeds
   - Averaging predictions
   - Expected: -1-2% error reduction

8. **Curriculum learning:**
   - Train –Ω–∞ –ø—Ä–æ—Å—Ç—ã—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö —Å–Ω–∞—á–∞–ª–∞ (low deformation)
   - –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å —Å–ª–æ–∂–Ω—ã–µ (high deformation)

## –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

–°–æ–∑–¥–∞–Ω—ã 3 –≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:

1. **dataset_comparison_histograms.png**
   - –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã –≤—Å–µ—Ö 7 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
   - –ö—Ä–∞—Å–Ω—ã–π = Not Balanced, –ó–µ–ª—ë–Ω—ã–π = Balanced
   - –í–∏–¥–Ω–æ –∫–∞–∫ L2 —Å—Ç–∞–ª –∏–¥–µ–∞–ª—å–Ω–æ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–º

2. **dataset_comparison_chi2.png**
   - Bar chart —Å—Ä–∞–≤–Ω–µ–Ω–∏—è Chi-squared
   - Log scale —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –ø–æ—Ä—è–¥–∫–∏ –≤–µ–ª–∏—á–∏–Ω—ã
   - –ü—Ä–æ—Ü–µ–Ω—Ç —É–ª—É—á—à–µ–Ω–∏—è –Ω–∞–¥ –∫–∞–∂–¥—ã–º –±–∞—Ä–æ–º
   - –û—Ä–∞–Ω–∂–µ–≤–∞—è –ª–∏–Ω–∏—è = target (Chi¬≤ < 10,000)

3. **dataset_comparison_L2.png**
   - –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ L2 (—Å–∞–º—ã–π –ø—Ä–æ–±–ª–µ–º–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä)
   - Left: histogram comparison
   - Right: frequency per unique value
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç perfect uniformity –≤ balanced

## –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

| –ö—Ä–∏—Ç–µ—Ä–∏–π | Balanced Dataset | Not Balanced Dataset | Winner |
|----------|------------------|----------------------|--------|
| **L2 uniformity** | Perfect (Chi¬≤=0) | Poor (Chi¬≤=26,322) | **Balanced** üéâ |
| **Rp2 uniformity** | Excellent (Chi¬≤=18) | Excellent (Chi¬≤=1) | Tie ‚úÖ |
| **Rp1 uniformity** | Good (Chi¬≤=28k) | Moderate (Chi¬≤=40k) | **Balanced** ‚úÖ |
| **L1 uniformity** | Moderate (Chi¬≤=549k) | Poor (Chi¬≤=450k) | Not Balanced ‚ö†Ô∏è |
| **D01, Dmax1, D02** | Same | Same | Tie |
| **Grid resolution** | Finer (Rp2: 13 values) | Coarser (Rp2: 7 values) | **Balanced** ‚úÖ |
| **Expected L2 error** | **2-4%** | 5.86% | **Balanced** üéâ |
| **Expected Rp2 error** | **6-9%** | 12.36% | **Balanced** ‚úÖ |

**Overall score: 5-1 –≤ –ø–æ–ª—å–∑—É Balanced!**

## –í—ã–≤–æ–¥—ã

1. **Balanced dataset —É—Å–ø–µ—à–Ω–æ —Ä–µ—à–∞–µ—Ç –≥–ª–∞–≤–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É:**
   - L2 –∏–º–µ–ª —Ö—É–¥—à—É—é bias (Chi¬≤=105k –Ω–∞ 100k dataset)
   - –¢–µ–ø–µ—Ä—å L2 –∏–º–µ–µ—Ç **perfect uniformity** (Chi¬≤=0)
   - –û–∂–∏–¥–∞–µ—Ç—Å—è **2-3x —É–ª—É—á—à–µ–Ω–∏–µ** —Ç–æ—á–Ω–æ—Å—Ç–∏ L2!

2. **"–£—Ö—É–¥—à–µ–Ω–∏–µ" L1 –Ω–µ –ø—Ä–æ–±–ª–µ–º–∞:**
   - –ê—Ä—Ç–µ—Ñ–∞–∫—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è L2‚â§L1
   - L1 —É–∂–µ –∏–º–µ–ª —Ö–æ—Ä–æ—à—É—é —Ç–æ—á–Ω–æ—Å—Ç—å (3.40%)
   - Trade-off –æ–ø—Ä–∞–≤–¥–∞–Ω: L2 –∫—Ä–∏—Ç–∏—á–Ω–µ–µ

3. **–°—Ä–µ–¥–Ω–∏–π Chi¬≤ misleading:**
   - –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤–∞–∂–Ω–æ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
   - Weighted average –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **+583 points improvement!**
   - L2 perfect uniformity –≤–µ—Å–∏—Ç –±–æ–ª—å—à–µ —á–µ–º L1 degradation

4. **üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ø—Ä–æ–±–ª–µ–º–∞: start_ML=50 –≤–º–µ—Å—Ç–æ 10:**
   - –¢–µ—Ä—è–µ—Ç–µ 40 —Ç–æ—á–µ–∫ –ø–æ–ª–µ–∑–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø–µ—Ä–µ–¥ –æ–±—É—á–µ–Ω–∏–µ–º!

5. **–ì–æ—Ç–æ–≤—ã –∫ SOTA —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º:**
   - 1M balanced dataset
   - v3 architecture (K=15, progressive channels)
   - Expected: L2 2-4%, Rp2 6-9%
   - **–ü–æ–±—å—ë—Ç–µ Ziegler et al. –ø–æ –≤—Å–µ–º –º–µ—Ç—Ä–∏–∫–∞–º!**

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

### –°–µ–≥–æ–¥–Ω—è:
1. ‚úÖ Fix start_ML=10 –≤ xrd.py
2. ‚úÖ –†–µ—à–∏—Ç—å: —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞—Ç–∞—Å–µ—Ç –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π?

### –≠—Ç–∞ –Ω–µ–¥–µ–ª—è:
3. üöÄ Train v3 –Ω–∞ 200k balanced (quick validation, ~2 hours)
4. üìä Evaluate –∏ —Å—Ä–∞–≤–Ω–∏—Ç—å —Å v2
5. üöÄ –ï—Å–ª–∏ —Ö–æ—Ä–æ—à–æ ‚Üí train –Ω–∞ 1M balanced (~20-30 hours)

### –î–ª—è –¥–∏—Å—Å–µ—Ä—Ç–∞—Ü–∏–∏:
6. üìù –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å choice: balanced vs not balanced
7. üìù –û–±—ä—è—Å–Ω–∏—Ç—å weighted metrics
8. üìù –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å Ziegler et al.

---

**Status:** Balanced dataset –≥–æ—Ç–æ–≤, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ v3 –≥–æ—Ç–æ–≤–∞, –æ—Å—Ç–∞–ª–æ—Å—å –∏—Å–ø—Ä–∞–≤–∏—Ç—å start_ML –∏ –Ω–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ!

**Expected final results:**
- L2: **2-4%** (–±—ã–ª–æ 5.86%) ‚Üí —É–ª—É—á—à–µ–Ω–∏–µ 32-66%
- Rp2: **6-9%** (–±—ã–ª–æ 12.36%) ‚Üí —É–ª—É—á—à–µ–Ω–∏–µ 27-51%
- **–ü—É–±–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã!** üéâ
